{% extends 'base.html' %}

{% load static %}
{% block content %}

<main class="container mt-5">
    <div class="row">
        <!-- Card 1 -->
        <div class="col-12 col-sm-6 col-md-4 col-lg-3">
            <div class="card h-100 card-item p-3">
                <div class="title-item-dashboard">
                    <span class="bg-primary p-3 rounded">
                        <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5"
                            height="30" stroke="white" class="size-6">
                            <path stroke-linecap="round" stroke-linejoin="round"
                                d="M10.5 1.5H8.25A2.25 2.25 0 0 0 6 3.75v16.5a2.25 2.25 0 0 0 2.25 2.25h7.5A2.25 2.25 0 0 0 18 20.25V3.75a2.25 2.25 0 0 0-2.25-2.25H13.5m-3 0V3h3V1.5m-3 0h3m-3 18.75h3" />
                        </svg>
                    </span>
                </div>
                <div class="data">
                    <span class="fw-bold">Em Opera√ß√£o</span>
                    <span id="total-em-operacao" class="m-0">{{ data_dashboard_info.total_em_operacao }}</span>
                </div>
            </div>
        </div>

        <!-- Card 2 -->
        <div class="col-12 col-sm-6 col-md-4 col-lg-3">
            <div class="card h-100 card-item p-3">
                <div class="title-item-dashboard">
                    <span class="bg-success p-3 rounded">
                        <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5"
                            height="30" stroke="white" class="size-6">
                            <path stroke-linecap="round" stroke-linejoin="round"
                                d="M10.5 1.5H8.25A2.25 2.25 0 0 0 6 3.75v16.5a2.25 2.25 0 0 0 2.25 2.25h7.5A2.25 2.25 0 0 0 18 20.25V3.75a2.25 2.25 0 0 0-2.25-2.25H13.5m-3 0V3h3V1.5m-3 0h3m-3 18.75h3" />
                        </svg>
                    </span>
                </div>
                <div class="data">
                    <span class="fw-bold">Dispon√≠veis</span>
                    <span id="total-disponivel" class="m-0">100</span>
                </div>
            </div>
        </div>

        <!-- Card 3 -->
        <div class="col-12 col-sm-6 col-md-4 col-lg-3">
            <div class="card h-100 card-item p-3 position-relative">
                <!-- √çcone de PDA -->
                <div class="title-item-dashboard">
                    <span class="bg-danger p-3 rounded">
                        <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5"
                            height="30" stroke="white">
                            <path stroke-linecap="round" stroke-linejoin="round"
                                d="M10.5 1.5H8.25A2.25 2.25 0 0 0 6 3.75v16.5a2.25 2.25 0 0 0 2.25 2.25h7.5A2.25 2.25 0 0 0 18 20.25V3.75a2.25 2.25 0 0 0-2.25-2.25H13.5m-3 0V3h3V1.5m-3 0h3m-3 18.75h3" />
                        </svg>
                    </span>
                </div>
                <div class="data">
                    <span class="fw-bold">N√£o Devolvidos</span>
                    <span id="total-alerta-entrega" class="m-0">100</span>
                </div>
                <!-- √çcone de alerta b√°sico -->
                <div class="alert-icon">
                    <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="red" width="50" height="50">
                        <path stroke-linecap="round" stroke-linejoin="round"
                            d="M12 9v3.75m-9.303 3.376c-.866 1.5.217 3.374 1.948 3.374h14.71c1.73 0 2.813-1.874 1.948-3.374L13.949 3.378c-.866-1.5-3.032-1.5-3.898 0L2.697 16.126ZM12 15.75h.007v.008H12v-.008Z" />
                    </svg>
                    
                </div>
            </div>
        </div>

        <!-- Card 4 -->
        <div class="col-12 col-sm-6 col-md-4 col-lg-3">
            <div class="card h-100 card-item p-3">
                <div class="title-item-dashboard">
                    <span class="bg-warning p-3 rounded">
                        <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5"
                            height="30" stroke="white" class="size-6">
                            <path stroke-linecap="round" stroke-linejoin="round"
                                d="M10.5 1.5H8.25A2.25 2.25 0 0 0 6 3.75v16.5a2.25 2.25 0 0 0 2.25 2.25h7.5A2.25 2.25 0 0 0 18 20.25V3.75a2.25 2.25 0 0 0-2.25-2.25H13.5m-3 0V3h3V1.5m-3 0h3m-3 18.75h3" />
                        </svg>
                    </span>
                </div>
                <div class="data">
                    <span class="fw-bold">Manuten√ß√£o</span>
                    <span id="total-manutencao" class="m-0">20</span>
                </div>
            </div>
        </div>
    </div>
    

    <div class="container mt-5 p-0 col-12 d-flex justify-content-between">
        <div class="col-lg-3 d-flex justify-content-center pe-3">
            <div class="card shadow border-0 p-2 rounded" style="width: 100%;">
                <div class="card-body text-center">
                    <p class="card-title mb-4 fw-bold" style="color: #4F4F4F;">Frequ√™ncia de Uso por Modelo</p>
                    <canvas id="grafico-status" style="max-height: 250px;"></canvas>
                </div>
            </div>
        </div>
        <div class="col-lg-3 d-flex justify-content-center pe-1">
            <div class="card shadow border-0 p-2 rounded" style="width: 100%;">
                <div class="card-body text-center">
                    <p class="card-title mb-4 fw-bold" style="color: #4F4F4F;">Controle de Opera√ß√£o</p>
                    <canvas id="grafico-controle" style="max-height: 250px;"></canvas>
                </div>
            </div>
        </div>
        <div class="col-lg-6 d-flex justify-content-center ps-3">
            <div class="card shadow border-0 p-2 rounded" style="width: 100%;">
                <div class="card-body text-center">
                    <p class="card-title mb-4 fw-bold" style="color: #4F4F4F;">M√©dia de PDA por Turno</p>
                    <canvas id="grafico-turnos" style="max-height: 250px;"></canvas>
                </div>
            </div>
        </div>
    </div>

    <div class="container mt-5">
        <div class="col-lg-12">
            <div class="card-header border-0">
                <h5 class="mb-3">PDA em opera√ß√£o</h5>
            </div>
            <table id="example" class="table table-striped table-bordered" style="width: 100%; table-layout: fixed;">
                <colgroup>
                    <col style="width: 5%;">
                    <col style="width: 20%;">
                    <col style="width: 15%;">
                    <col style="width: 15%;">
                    <col style="width: 20%;">
                    <col style="width: 15%;">
                    <col style="width: 10%;">
                </colgroup>
                <thead class="table-dark">
                    <tr>
                        <th style="text-align: left;">#</th>
                        <th style="text-align: left;">N√∫mero de S√©rie</th>
                        <th style="text-align: left;">Modelo</th>
                        <th style="text-align: left;">Operador</th>
                        <th style="text-align: left;">Data Retirada</th>
                        <th style="text-align: left;">Hor√°rio Retirado</th>
                        <th style="text-align: left;">Status</th>
                    </tr>
                </thead>
                <tbody>
                    {% for equipamento in equipamentos_data %}
                        <tr>
                            <td style="text-align: left;">{{ forloop.counter }}</td>
                            <td style="text-align: left;">{{ equipamento.serial_number }}</td>
                            <td style="text-align: left;">{{ equipamento.modelo }}</td>
                            <td style="text-align: left;">{{ equipamento.usuario }}</td>
                            <td style="text-align: left;">{{ equipamento.timestamp|date:"m/d/Y" }}</td>
                            <td style="text-align: left;">{{ equipamento.timestamp|date:"H:i" }}</td>
                            <td style="text-align: left;">
                                {% if equipamento.status == 'Retirado' %}
                                    üîµ Em opera√ß√£o
                                {% else %}
                                    {{ equipamento.status }}
                                {% endif %}
                            </td>
                        </tr>
                    {% empty %}
                        <tr>
                            <td colspan="6" class="text-center" style="text-align: left;">Nenhum equipamento encontrado.</td>
                        </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
    </div>
</main>


<script>
    const dashboardInfo = JSON.parse('{{ data_dashboard_info|safe }}');
    // Selecionar os elementos que voc√™ deseja atualizar
    const totalEmOperacaoElement = document.querySelector('#total-em-operacao');
    const totalDisponivelElement = document.querySelector('#total-disponivel');
    const totalManutencaoElement = document.querySelector('#total-manutencao');
    const totalAlertaEntregaElement = document.querySelector('#total-alerta-entrega');

    // Atualizar o conte√∫do com os dados
    if (dashboardInfo) {
        totalEmOperacaoElement.textContent = dashboardInfo.total_em_operacao;
        totalDisponivelElement.textContent = dashboardInfo.total_disponivel;
        totalManutencaoElement.textContent = dashboardInfo.total_manutencao;
        totalAlertaEntregaElement.textContent = dashboardInfo.total_alerta_entrega;
    } else {
        console.error('0');
    }


    // Data Table
    new DataTable('#example',{
        info: false,
        ordering: false,
        columnDefs: [
            {
                target: 4,
                render: DataTable.render.date()
            }
        ]
    });

    // =======================================
    //  Gr√°fico 1
    // =======================================
    // Parse dos dados passados do Django para o JavaScript
    const chartData = JSON.parse('{{ chart_data_porcentagem|escapejs }}');
    // Configura√ß√£o do Chart.js
    const ctx = document.getElementById('grafico-status').getContext('2d');
    const chart = new Chart(ctx, {
        type: 'doughnut', // Tipo do gr√°fico (pizza)
        data: {
            labels: chartData.categories, // Categorias (status ou modelos, dependendo dos dados fornecidos)
            datasets: [{
                label: 'Porcentagem de Retiradas por Modelo',
                data: chartData.series, // Dados (percentuais ou valores)
                backgroundColor: [
                    'rgb(255, 193, 7)',
                    'rgb(255, 99, 132)',
                    'rgb(75, 192, 192)',
                    'rgb(201, 203, 207)',
                    'rgb(54, 162, 235)'
                ], // Cores para as fatias
                borderWidth: 0, // Remove a borda das fatias
            }]
        },
        options: {
            responsive: true, // Faz o gr√°fico se ajustar ao tamanho do cont√™iner
            plugins: {
                legend: {
                    position: 'top', // Posiciona a legenda no topo
                    labels: {
                        usePointStyle: true, // Usa pontos ao inv√©s de quadrados na legenda
                        padding: 15, // Espa√ßamento entre os itens da legenda
                    },
                },
                tooltip: {
                    enabled: true, // Habilita tooltips ao passar o mouse sobre as fatias
                    callbacks: {
                        label: function(context) {
                            const value = context.raw; // Valor da fatia
                            return `${context.label}: ${value}%`; // Exibe o nome e porcentagem
                        }
                    }
                }
            },
            layout: {
                padding: {
                    top: 10,
                    bottom: 10,
                    left: 10,
                    right: 10,
                }, // Adiciona espa√ßamento ao redor do gr√°fico
            },
            elements: {
                arc: {
                    borderWidth: 0, // Remove bordas das fatias
                }
            },
            maintainAspectRatio: false, // Permite ajustar altura e largura
        }
    });


    // =======================================
    //  Gr√°fico 2
    // =======================================
    // Obtendo os dados do gr√°fico do template
    const chartData2 = JSON.parse('{{ data_pda_controle|escapejs }}');

    // Configura√ß√£o do Chart.js
    const ctx2 = document.getElementById('grafico-controle').getContext('2d');
    const chart2 = new Chart(ctx2, {
        type: 'pie', // Tipo de gr√°fico
        data: {
            labels: chartData2.categories,
            datasets: [{
                data: chartData2.series,
                backgroundColor: [
                    'rgb(54, 162, 235)',
                    'rgb(25, 135, 84)',
                    'rgb(255, 193, 7)',
                ],
                borderWidth: 0
            }]
        },
        options: {
            responsive: true,
            plugins: {
                legend: {
                    position: 'top',
                },
                tooltip: {
                    enabled: true,
                },
            },
        },
    });



    // =======================================
    //  Gr√°fico 3
    // =======================================
    // Obtendo os dados do gr√°fico do template
    const chartData3 = JSON.parse('{{ chart_data_por_turno|escapejs }}');
    // Configura√ß√£o do Chart.js
    const ctx3 = document.getElementById('grafico-turnos').getContext('2d');
    const chart3 = new Chart(ctx3, {
        type: 'line', // Tipo do gr√°fico (linha)
        data: chartData3,
        options: {
            responsive: true,
            plugins: {
                legend: {
                    position: 'top', // Posiciona a legenda
                },
                tooltip: {
                    enabled: true, // Habilita tooltips
                },
            },
            scales: {
                x: {
                    title: {
                        display: true,
                        text: 'Dias da Semana',
                    },
                    grid: {
                        display: false, // Remove as linhas de grade horizontais
                    },
                },
                y: {
                    title: {
                        display: false,
                        // text: 'M√©dia de Equipamentos'
                    },
                    beginAtZero: true,
                    grid: {
                        display: false, // Remove as linhas de grade verticais
                    },
                    ticks: {
                        stepSize: 1, // Mostra valores inteiros com incremento de 1
                        precision: 0, // Garante que os valores sejam inteiros
                    },
                },
            },
            backgroundColor: 'transparent',
        },
        datasets: [{
            label: 'M√©dia de Equipamentos',
            data: chartData3.data, // Dados do gr√°fico
            borderColor: 'rgba(75, 192, 192, 1)', // Cor da linha
            backgroundColor: 'rgba(75, 192, 192, 0.2)', // Cor de preenchimento abaixo da linha
            tension: 0.4, // Adiciona suavidade √† linha
            fill: true, // Ativa o preenchimento abaixo da linha
        }],
    });

</script>
{% endblock %}