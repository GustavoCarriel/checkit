{% extends 'base.html' %}

{% load static %}
{% block content %}

<main class="container mt-5">
    <div class="row">
        <!-- Card 1 -->
        <div class="col-12 col-sm-6 col-md-4 col-lg-3">
            <div class="card h-100 card-item p-3 position-relative">
                <!-- Ícone de PDA (manter no lugar usual) -->
                <div class="title-item-dashboard">
                    <span class="bg-primary p-3 rounded">
                        <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5"
                            height="30" stroke="white" class="size-6">
                            <path stroke-linecap="round" stroke-linejoin="round"
                                d="M10.5 1.5H8.25A2.25 2.25 0 0 0 6 3.75v16.5a2.25 2.25 0 0 0 2.25 2.25h7.5A2.25 2.25 0 0 0 18 20.25V3.75a2.25 2.25 0 0 0-2.25-2.25H13.5m-3 0V3h3V1.5m-3 0h3m-3 18.75h3" />
                        </svg>
                    </span>
                </div>
                <div class="data">
                    <span class="fw-bold">Em operação</span>
                    <span class="m-0">500</span>
                </div>
        
                <!-- Ícone de alerta pulsante -->
                <span class="alert-icon">
                    <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="size-6">
                        <path stroke-linecap="round" stroke-linejoin="round" d="M12 9v3.75m-9.303 3.376c-.866 1.5.217 3.374 1.948 3.374h14.71c1.73 0 2.813-1.874 1.948-3.374L13.949 3.378c-.866-1.5-3.032-1.5-3.898 0L2.697 16.126ZM12 15.75h.007v.008H12v-.008Z" />
                      </svg>                      
                </span>
            </div>
        </div>

        <!-- Card 2 -->
        <div class="col-12 col-sm-6 col-md-4 col-lg-3">
            <div class="card h-100 card-item p-3">
                <div class="title-item-dashboard">
                    <span class="bg-success p-3 rounded">
                        <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5"
                            height="30" stroke="white" class="size-6">
                            <path stroke-linecap="round" stroke-linejoin="round"
                                d="M10.5 1.5H8.25A2.25 2.25 0 0 0 6 3.75v16.5a2.25 2.25 0 0 0 2.25 2.25h7.5A2.25 2.25 0 0 0 18 20.25V3.75a2.25 2.25 0 0 0-2.25-2.25H13.5m-3 0V3h3V1.5m-3 0h3m-3 18.75h3" />
                        </svg>
                    </span>
                </div>
                <div class="data">
                    <span class="fw-bold">Disponíveis</span>
                    <span class="m-0">100</span>
                </div>
            </div>
        </div>

        <!-- Card 3 -->
        <div class="col-12 col-sm-6 col-md-4 col-lg-3">
            <div class="card h-100 card-item p-3">
                <div class="title-item-dashboard">
                    <span class="bg-danger p-3 rounded">
                        <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5"
                            height="30" stroke="white" class="size-6">
                            <path stroke-linecap="round" stroke-linejoin="round"
                                d="M10.5 1.5H8.25A2.25 2.25 0 0 0 6 3.75v16.5a2.25 2.25 0 0 0 2.25 2.25h7.5A2.25 2.25 0 0 0 18 20.25V3.75a2.25 2.25 0 0 0-2.25-2.25H13.5m-3 0V3h3V1.5m-3 0h3m-3 18.75h3" />
                        </svg>
                    </span>
                </div>
                <div class="data">
                    <span class="fw-bold">Não devolvidos</span>
                    <span class="m-0">20</span>
                </div>
            </div>
        </div>

        <!-- Card 4 -->
        <div class="col-12 col-sm-6 col-md-4 col-lg-3">
            <div class="card h-100 card-item p-3">
                <div class="title-item-dashboard">
                    <span class="bg-warning p-3 rounded">
                        <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5"
                            height="30" stroke="white" class="size-6">
                            <path stroke-linecap="round" stroke-linejoin="round"
                                d="M10.5 1.5H8.25A2.25 2.25 0 0 0 6 3.75v16.5a2.25 2.25 0 0 0 2.25 2.25h7.5A2.25 2.25 0 0 0 18 20.25V3.75a2.25 2.25 0 0 0-2.25-2.25H13.5m-3 0V3h3V1.5m-3 0h3m-3 18.75h3" />
                        </svg>
                    </span>
                </div>
                <div class="data">
                    <span class="fw-bold">Manutenção</span>
                    <span class="m-0">20</span>
                </div>
            </div>
        </div>
    </div>
    

    <div class="container mt-5 p-0 col-12 d-flex justify-content-between">
        <div class="col-lg-3 d-flex justify-content-center pe-3">
            <div class="card shadow-sm border-0 p-1 rounded" style="width: 100%;">
                <div class="card-body text-center">
                    <p class="card-title mb-2 fw-bold" style="color: #4F4F4F;">Frequência de Uso por Modelo</p>
                    <canvas id="grafico-status" style="max-height: 300px;"></canvas>
                </div>
            </div>
        </div>
        <div class="col-lg-6 d-flex justify-content-center ps-3">
            <div class="card shadow-sm border-0 p-2 rounded" style="width: 100%;">
                <div class="card-body text-center">
                    <p class="card-title mb-4 fw-bold" style="color: #4F4F4F;">Média de PDA por Turno</p>
                    <canvas id="grafico-turnos" style="max-height: 250px;"></canvas>
                </div>
            </div>
        </div>
        <!-- <div class="col-lg-8">
            <div class="card-header border-0">
                <h5 class="mb-3">PDA em operação</h5>
            </div>
            <table id="example" class="table table-striped table-bordered" style="width: 100%; table-layout: fixed;">
                <colgroup>
                    <col style="width: 5%;">
                    <col style="width: 20%;">
                    <col style="width: 15%;">
                    <col style="width: 15%;">
                    <col style="width: 20%;">
                    <col style="width: 15%;">
                    <col style="width: 10%;">
                </colgroup>
                <thead class="table-dark">
                    <tr>
                        <th style="text-align: left;">#</th>
                        <th style="text-align: left;">Número de Série</th>
                        <th style="text-align: left;">Modelo</th>
                        <th style="text-align: left;">Operador</th>
                        <th style="text-align: left;">Data</th>
                        <th style="text-align: left;">Horário</th>
                        <th style="text-align: left;">Status</th>
                    </tr>
                </thead>
                <tbody>
                    {% for equipamento in equipamentos_data %}
                        <tr>
                            <td style="text-align: left;">{{ forloop.counter }}</td>
                            <td style="text-align: left;">{{ equipamento.serial_number }}</td>
                            <td style="text-align: left;">{{ equipamento.modelo }}</td>
                            <td style="text-align: left;">{{ equipamento.usuario }}</td>
                            <td style="text-align: left;">{{ equipamento.timestamp|date:"d/m/Y" }}</td>
                            <td style="text-align: left;">{{ equipamento.timestamp|date:"H:i" }}</td>
                            <td style="text-align: left;">{{ equipamento.status }}</td>
                        </tr>
                    {% empty %}
                        <tr>
                            <td colspan="6" class="text-center" style="text-align: left;">Nenhum equipamento encontrado.</td>
                        </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div> -->
        
    </div>
</main>


<script>
    new DataTable('#example');

    // =======================================
    //  Gráfico 1
    // =======================================
    // Parse dos dados passados do Django para o JavaScript
    const chartData = JSON.parse('{{ chart_data|escapejs }}');
    // Configuração do Chart.js
    const ctx = document.getElementById('grafico-status').getContext('2d');
    const chart = new Chart(ctx, {
        type: 'pie', // Tipo do gráfico (pizza)
        data: {
            labels: chartData.categories, // Categorias (status ou modelos, dependendo dos dados fornecidos)
            datasets: [{
                label: 'Porcentagem de Retiradas por Modelo',
                data: chartData.series, // Dados (percentuais ou valores)
                backgroundColor: [
                    'rgba(75, 192, 192, 0.9)',
                    'rgba(153, 102, 255, 0.9)',
                    'rgba(255, 99, 132, 0.9)',
                    'rgba(255, 205, 86, 0.9)',
                    'rgba(54, 162, 235, 0.9)'
                ], // Cores para as fatias
                borderWidth: 0, // Remove a borda das fatias
            }]
        },
        options: {
            responsive: true, // Faz o gráfico se ajustar ao tamanho do contêiner
            plugins: {
                legend: {
                    position: 'top', // Posiciona a legenda no topo
                    labels: {
                        usePointStyle: true, // Usa pontos ao invés de quadrados na legenda
                        padding: 15, // Espaçamento entre os itens da legenda
                    },
                },
                tooltip: {
                    enabled: true, // Habilita tooltips ao passar o mouse sobre as fatias
                    callbacks: {
                        label: function(context) {
                            const value = context.raw; // Valor da fatia
                            return `${context.label}: ${value}%`; // Exibe o nome e porcentagem
                        }
                    }
                }
            },
            layout: {
                padding: {
                    top: 10,
                    bottom: 10,
                    left: 10,
                    right: 10,
                }, // Adiciona espaçamento ao redor do gráfico
            },
            elements: {
                arc: {
                    borderWidth: 0, // Remove bordas das fatias
                }
            },
            maintainAspectRatio: false, // Permite ajustar altura e largura
        }
    });



    // =======================================
    //  Gráfico 2
    // =======================================
    // Obtendo os dados do gráfico do template
    const chartData2 = JSON.parse('{{ chart_data2|escapejs }}');
    // Configuração do Chart.js
    const ctx2 = document.getElementById('grafico-turnos').getContext('2d');
    const chart2 = new Chart(ctx2, {
    type: 'line', // Tipo do gráfico (linha)
    data: chartData2,
    options: {
        responsive: true,
        plugins: {
            legend: {
                position: 'top', // Posiciona a legenda
            },
            tooltip: {
                enabled: true, // Habilita tooltips
            },
        },
        scales: {
            x: {
                title: {
                    display: true,
                    text: 'Dias da Semana',
                },
                grid: {
                    display: false, // Remove as linhas de grade horizontais
                },
            },
            y: {
                title: {
                    display: false,
                    // text: 'Média de Equipamentos'
                },
                beginAtZero: true,
                grid: {
                    display: false, // Remove as linhas de grade verticais
                },
                ticks: {
                    stepSize: 1, // Mostra valores inteiros com incremento de 1
                    precision: 0, // Garante que os valores sejam inteiros
                },
            },
        },
        backgroundColor: 'transparent',
    },
    datasets: [{
        label: 'Média de Equipamentos',
        data: chartData2.data, // Dados do gráfico
        borderColor: 'rgba(75, 192, 192, 1)', // Cor da linha
        backgroundColor: 'rgba(75, 192, 192, 0.2)', // Cor de preenchimento abaixo da linha
        tension: 0.4, // Adiciona suavidade à linha
        fill: true, // Ativa o preenchimento abaixo da linha
    }],
});

</script>
{% endblock %}